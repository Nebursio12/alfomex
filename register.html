<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Registro - Alfomex</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #3b5998, #8b9dc3, #e1306c);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .register-box {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    max-width: 500px;
    width: 100%;
    overflow-y: auto;
    max-height: 95vh;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
  }
  button {
    width: 100%;
    padding: 12px;
    background-color: #3b5998;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    margin-top: 15px;
  }
  button:hover {
    background-color: #2d4373;
  }
  .error {
    color: red;
    text-align: center;
    margin-top: 10px;
  }
  .criteria {
    font-size: 0.85rem;
    margin-top: -5px;
    margin-bottom: 10px;
  }
  .criteria span {
    display: block;
  }
  .criteria .valid {
    color: green;
  }
  .criteria .invalid {
    color: #d00000;
  }
  .link {
    text-align: center;
    margin-top: 15px;
  }
  .link a {
    color: #3b5998;
    text-decoration: none;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div class="register-box">
    <h2>Crear cuenta</h2>
    <input type="text" id="nombre1" placeholder="Primer Nombre" required />
    <input type="text" id="nombre2" placeholder="Segundo Nombre (opcional)" />
    <input type="text" id="apellido1" placeholder="Primer Apellido" required />
    <input type="text" id="apellido2" placeholder="Segundo Apellido (opcional)" />

    <input type="date" id="nacimiento" />

    <input
      type="tel"
      id="telefono"
      placeholder="Número Telefónico"
      maxlength="10"
      required
      oninput="this.value = this.value.replace(/[^0-9]/g, '')"
    />

    <select id="pais" required>
      <option value="">Selecciona un país</option>
      <option value="MEXICO">México</option>
      <option value="ESTADOS_UNIDOS">Estados Unidos</option>
    </select>

    <input type="email" id="email" placeholder="Correo electrónico" required />

    <input type="password" id="password" placeholder="Contraseña" required />
    <div class="criteria" id="criterios">
      <span id="criterio-long" class="invalid">❌ Mínimo 6 caracteres</span>
      <span id="criterio-mayus" class="invalid">❌ Al menos una mayúscula</span>
      <span id="criterio-simbolo" class="invalid">❌ Al menos un símbolo (!@#$%)</span>
    </div>

    <input type="password" id="confirmPassword" placeholder="Confirmar Contraseña" required />

    <button onclick="registrar()">Registrarse</button>
    <div class="error" id="errorMsg"></div>
    <div class="link">
      ¿Ya tienes cuenta? <a onclick="window.location.href='index.html'">Inicia sesión</a>
    </div>
  </div>

<script type="module">
  import { auth, createUserWithEmailAndPassword } from './auth.js';

  document.addEventListener('DOMContentLoaded', () => {
    // Escuchar input para validar contraseña en tiempo real
    document.getElementById('password').addEventListener('input', validarCriterios);
  });

  function validarCriterios() {
    const pass = document.getElementById('password').value;
    const long = document.getElementById('criterio-long');
    const mayus = document.getElementById('criterio-mayus');
    const simbolo = document.getElementById('criterio-simbolo');

    if (pass.length >= 6) {
      long.classList.add('valid');
      long.classList.remove('invalid');
      long.textContent = '✅ Mínimo 6 caracteres';
    } else {
      long.classList.add('invalid');
      long.classList.remove('valid');
      long.textContent = '❌ Mínimo 6 caracteres';
    }

    if (/[A-Z]/.test(pass)) {
      mayus.classList.add('valid');
      mayus.classList.remove('invalid');
      mayus.textContent = '✅ Al menos una mayúscula';
    } else {
      mayus.classList.add('invalid');
      mayus.classList.remove('valid');
      mayus.textContent = '❌ Al menos una mayúscula';
    }

    if (/[^A-Za-z0-9]/.test(pass)) {
      simbolo.classList.add('valid');
      simbolo.classList.remove('invalid');
      simbolo.textContent = '✅ Al menos un símbolo (!@#$%)';
    } else {
      simbolo.classList.add('invalid');
      simbolo.classList.remove('valid');
      simbolo.textContent = '❌ Al menos un símbolo (!@#$%)';
    }
  }

  async function registrar() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const errorMsg = document.getElementById('errorMsg');

    errorMsg.textContent = '';

    if (password !== confirmPassword) {
      errorMsg.textContent = 'Las contraseñas no coinciden.';
      return;
    }

    if (password.length < 6 || !/[A-Z]/.test(password) || !/[^A-Za-z0-9]/.test(password)) {
      errorMsg.textContent = 'La contraseña no cumple con los requisitos.';
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      window.location.href = user.email === 'alfomexgo@gmail.com' ? 'admin.html' : 'index.html';
    } catch (error) {
      errorMsg.textContent = error.message;
    }
  }
</script>
</body>
</html>
