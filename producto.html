<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Producto - Alfomex</title>
  <link rel="stylesheet" href="index.css">
  <link rel="stylesheet" href="producto.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<header>
  <button onclick="abrirCarrito()" title="Carrito" class="icon-btn btn-carrito">
    <i class="fas fa-shopping-cart"></i>
    <span id="contadorCarrito" class="contador-carrito">0</span>
  </button>
  <div class="logo">ALFOMEX</div>
  <nav id="navOptions">
    <button onclick="abrirModal()">Entrar</button>
  </nav>
</header>

<div id="carritoLista" class="carrito-lista oculto">
  <div id="mensajeCarritoVacio" style="text-align:center; color:#666;">ðŸ›’ El carrito estÃ¡ vacÃ­o</div>
  <div id="resumenCarrito" style="margin-top: 15px; display: none;">
    <hr style="margin: 10px 0;">
    <div style="font-weight: bold; font-size: 1rem; margin-bottom: 10px;">Total: $<span id="totalCarrito">0</span></div>
    <button onclick="comprarAhora()" style="width: 100%; padding: 10px; background: black; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Comprar Ahora</button>
  </div>
</div>

<main class="producto-contenedor">
  <div class="producto-imagen">
    <img id="imgPrincipal" src="" alt="Imagen del producto" loading="lazy">
  </div>

  <div class="producto-detalles">
    <h1 id="nombreProducto">Cargando...</h1>
    <p id="precioProducto">$0.00</p>
    <p id="descripcionProducto">Cargando descripciÃ³n...</p>

    <div class="acciones">
      <button id="aÃ±adirCarrito">ðŸ›’ AÃ±adir al carrito</button>
      <button id="comprarAhora">ðŸ’³ Comprar ahora</button>
    </div>
  </div>
</main>

<script type="module">
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
import { db } from "/js/indexmodulos/config.js";
import "/js/indexmodulos/carritoindex.js";
import "/js/indexmodulos/authindex.js";
import "/js/indexmodulos/modal.js";

const params = new URLSearchParams(location.search);
const id = params.get("id");

async function cargarProducto() {
  const ref = doc(db, "menu", id);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    document.body.innerHTML = "<h2>Producto no encontrado</h2>";
    return;
  }

  const data = snap.data();

  document.getElementById("nombreProducto").textContent = data.nombre;
  document.getElementById("precioProducto").textContent = `$${data.precio}`;
  document.getElementById("imgPrincipal").src = data.imagen;
  document.getElementById("descripcionProducto").textContent = data.descripcion || "Sin descripciÃ³n disponible";

  const producto = {
    nombre: data.nombre,
    precio: data.precio,
    imagen: data.imagen
  };

  document.getElementById("aÃ±adirCarrito").addEventListener("click", () => aÃ±adirAlCarrito(producto));

  document.getElementById("comprarAhora").addEventListener("click", () => comprarAhoraDirecto(producto));
}

function aÃ±adirAlCarrito(producto) {
  let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  carrito.push(producto);
  localStorage.setItem("carrito", JSON.stringify(carrito));
  alert("Producto aÃ±adido al carrito âœ…");
}

function comprarAhoraDirecto(producto) {
  localStorage.setItem("carrito", JSON.stringify([producto]));
  location.href = "index.html#carritoLista";
}

cargarProducto();
</script>

</body>
</html>
